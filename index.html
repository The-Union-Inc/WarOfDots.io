<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dot Warfare</title>
<style>
html,body{
    margin:0;
    padding:0;
    overflow:hidden;
    background:#2e5f2e; /* green battlefield */
    font-family:sans-serif;
}
canvas{ display:block; }
#ui{
    position:absolute;
    bottom:10px;
    left:10px;
    color:white;
    font-size:16px;
}
</style>
</head>
<body>
<div id="ui">
Player Casualties: <span id="pcas">0</span><br>
Enemy Casualties: <span id="ecas">0</span>
</div>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const pcasEl=document.getElementById("pcas");
const ecasEl=document.getElementById("ecas");

function resize(){
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

class Unit{
    constructor(x,y,team){
        this.x=x;
        this.y=y;
        this.team=team;
        this.radius=14; // bigger dots
        this.speed=1;
        this.target=null;
        this.hp=10000; // 10k soldiers
    }
    update(){
        if(this.target){
            let dx=this.target.x-this.x;
            let dy=this.target.y-this.y;
            let dist=Math.hypot(dx,dy);
            if(dist>2){
                this.x+=dx/dist*this.speed;
                this.y+=dy/dist*this.speed;
            }
        }
    }
    draw(){
        ctx.beginPath();
        ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
        ctx.fillStyle=this.team==="player"?"#4da6ff":"#ff4d4d";
        ctx.fill();

        // soldier count text
        ctx.fillStyle="white";
        ctx.font="10px sans-serif";
        ctx.textAlign="center";
        ctx.fillText(Math.floor(this.hp/1000)+"k",this.x,this.y+3);
    }
}

function dist(a,b){
    return Math.hypot(a.x-b.x,a.y-b.y);
}

let units=[];
let playerCas=0;
let enemyCas=0;

for(let i=0;i<10;i++){
    units.push(new Unit(150+Math.random()*200,200+Math.random()*200,"player"));
    units.push(new Unit(canvas.width-200+Math.random()*150,200+Math.random()*200,"enemy"));
}

let dragging=false;
let dragStart=null;
let selectedUnits=[];

canvas.addEventListener("mousedown",startDrag);
canvas.addEventListener("touchstart",e=>startDrag(e.touches[0]));

canvas.addEventListener("mousemove",moveDrag);
canvas.addEventListener("touchmove",e=>{
    moveDrag(e.touches[0]);
    e.preventDefault();
},{passive:false});

canvas.addEventListener("mouseup",endDrag);
canvas.addEventListener("touchend",endDrag);

function startDrag(e){
    dragging=true;
    dragStart={x:e.clientX,y:e.clientY};

    selectedUnits=[];
    for(let u of units){
        if(u.team==="player" && dist(u,{x:e.clientX,y:e.clientY})<u.radius){
            selectedUnits.push(u);
        }
    }
}

function moveDrag(e){
    if(!dragging)return;
}

function endDrag(e){
    if(!dragging)return;
    dragging=false;

    let endX=e.changedTouches?e.changedTouches[0].clientX:e.clientX;
    let endY=e.changedTouches?e.changedTouches[0].clientY:e.clientY;

    for(let u of selectedUnits){
        u.target={x:endX,y:endY};
    }
}

function drawArrow(fromX,fromY,toX,toY){
    ctx.strokeStyle="yellow";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(fromX,fromY);
    ctx.lineTo(toX,toY);
    ctx.stroke();

    // arrow head
    let angle=Math.atan2(toY-fromY,toX-fromX);
    ctx.beginPath();
    ctx.moveTo(toX,toY);
    ctx.lineTo(toX-10*Math.cos(angle-0.3),toY-10*Math.sin(angle-0.3));
    ctx.lineTo(toX-10*Math.cos(angle+0.3),toY-10*Math.sin(angle+0.3));
    ctx.closePath();
    ctx.fillStyle="yellow";
    ctx.fill();
}

function enemyAI(){
    for(let u of units){
        if(u.team==="enemy"){
            if(!u.target || Math.random()<0.01){
                let playerUnits=units.filter(x=>x.team==="player");
                if(playerUnits.length>0){
                    let target=playerUnits[Math.floor(Math.random()*playerUnits.length)];
                    u.target={x:target.x,y:target.y};
                }
            }
        }
    }
}

function combat(){
    for(let a of units){
        for(let b of units){
            if(a!==b && a.team!==b.team && dist(a,b)<20){
                let damage=20;
                a.hp-=damage;
                b.hp-=damage;

                if(a.hp<=0){
                    if(a.team==="player") playerCas+=10000;
                    else enemyCas+=10000;
                }
                if(b.hp<=0){
                    if(b.team==="player") playerCas+=10000;
                    else enemyCas+=10000;
                }
            }
        }
    }
    units=units.filter(u=>u.hp>0);
    pcasEl.textContent=playerCas;
    ecasEl.textContent=enemyCas;
}

function gameLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // subtle grass texture effect
    for(let i=0;i<canvas.width;i+=40){
        for(let j=0;j<canvas.height;j+=40){
            ctx.fillStyle=Math.random()>0.5?"#2e6f2e":"#356f35";
            ctx.fillRect(i,j,40,40);
        }
    }

    units.forEach(u=>{
        u.update();
        u.draw();
    });

    if(dragging && selectedUnits.length>0){
        for(let u of selectedUnits){
            drawArrow(u.x,u.y,dragStart.x,dragStart.y);
        }
    }

    enemyAI();
    combat();

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
